{% extends 'base.html' %}

{% block title %}EvoPIE{% endblock %}

{% block head%}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">  
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
<script>
    $(document).ready( function () {
        $('#gradingtable').DataTable();
    } );
</script>
{% endblock %}

{% block content %}
<div class="jumbotron jumbotron-fluid">
    <div class="container">
        <h1 class="display-4">Quizzes Browser</h1>
            <p class="lead">
                Use this to find quizzes that are of interest to you. 
                Take note of their quiz ID so that you may then select to
                deploy them to your students or even edit them.
            </p>
    </div>
</div>

<!div class="card-deck">







<div class="card bg-light m-3 mx-auto" style="width: 75%">
    <div class="card-body" bg-light>
        <h5 class="card-title" data-toggle = "collapse" data-target = "#newquizquestion">Compose new QuizQuestion</h5>
        <div  id = "newquizquestion" class = "collapse">
        <p class="card-text">
            <form id='QuizQuestionForm'>
                <div class="form-group">
                    <label for="qq_qid">Question ID</label>
                    <input name="qq_qid" id="qq_qid" value="2" required>
                </div>
                <div class="form-group">
                    <label for="qq_d1">Distractor #1</label>
                    <input name="qq_d1" id="qq_d1" required>
                </div>
                <div class="form-group">
                    <label for="qq_d2">Distractor #2</label>
                    <input name="qq_d2" id="qq_d2" required>
                </div>
                <div class="form-group">
                    <label for="qq_d3">Distractor #3</label>
                    <input name="qq_d3" id="qq_d3" required>
                </div>
                <p name="result" id="result">
                </p>
                <button onclick="submitQuizQuestionForm()" class="btn btn-primary">Submit</button>
            </form>
        </p></div>
    </div>
</div>



<script type="text/javascript">
    function submitQuizQuestionForm(){
        let result = document.querySelector('#result');
        let qid = document.querySelector('#qq_qid');
        let d1 = document.querySelector('#qq_d1');
        let d2 = document.querySelector('#qq_d2');
        let d3 = document.querySelector('#qq_d3');
            
        let xhr = new XMLHttpRequest();
        let url = '/quizquestions';
    
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/json");

        // Create a state change callback 
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                result.innerHTML = this.responseText;
                }
        };

        // Converting JSON data to string 
        var data = JSON.stringify({ "qid": parseInt(qid.value), "distractors_ids": [parseInt(d1.value), parseInt(d2.value), parseInt(d3.value)] }); 
        console.log("sending --> " + data)
        // Sending data with the request 
        xhr.send(data);
    }
</script>



<div class="card bg-light m-3 mx-auto" style="width: 75%">
    <div class="card-body" bg-light>
        <h5 class="card-title" data-toggle = "collapse" data-target = "#newquiz">Compose new Quiz</h5>
        <div  id = "newquiz" class = "collapse">
        <p class="card-text">
            <form id='QuizForm'>
                <div class="form-group">
                    <label for="quiz_title">Title</label>
                    <input name="quiz_title" id="quiz_title" value="Your Quiz Title" required>
                </div>
                <div class="form-group">
                    <label for="quiz_description">Description</label>
                    <!--<input name="quiz_description" id="quiz_description" value="Your Quiz Description" required>
                    -->
                    <textarea class="summernote form-control" name="quiz_description" id="quiz_description" required></textarea>
                </div>
                <div class="form-group">
                    <label for="quiz_qq1">QuizQuestion #1</label>
                    <input name="iz_qq1" id="quiz_qq1" required>
                </div>
                <div class="form-group">
                    <label for="quiz_qq2"></label>QuizQuestion #2</label>
                    <input name="quiz_qq2" id="quiz_qq2" required>
                </div>
                <div class="form-group">
                    <label for="quiz_qq3">QuizQuestion #3</label>
                    <input name="quiz_qq3" id="quiz_qq3" required>
                </div>
                <p name="quiz_result" id="quiz_result">
                </p>
                <button onclick="submitQuizForm()" class="btn btn-primary">Submit</button>
            </form>
        </p>
        </div>
    </div>
</div>



<script type="text/javascript">
    function submitQuizForm(){
        let result = document.querySelector('#quiz_result');
        let title = document.querySelector('#quiz_title');
        let description = document.querySelector('#quiz_description');
        let qq1 = document.querySelector('#quiz_qq1');
        let qq2 = document.querySelector('#quiz_qq2');
        let qq3 = document.querySelector('#quiz_qq3');
            
        let xhr = new XMLHttpRequest();
        let url = '/quizzes';
    
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/json");

        // Create a state change callback 
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                result.innerHTML = this.responseText;
                }
        };

        // Converting JSON data to string 
        var data = JSON.stringify({ "title": title.value, "description": description.value, "questions_ids": [parseInt(qq1.value), parseInt(qq2.value), parseInt(qq3.value)] }); 
        console.log("sending --> " + data)
        // Sending data with the request 
        xhr.send(data);
    }
</script>










    <div class="card bg-light m-3 mx-auto" style="width: 75%">
        
        <div class="card-body" bg-light>
    
            <table class='compact stripe' width='100%' id="gradingtable">
                <thead><tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Actions</th>
                </tr></thead>
                <tbody>
                        
                {% for single_quiz in all_quizzes %}
                    <tr>
                        <td>
                            {{ single_quiz.id }}
                        </td>
                        <td>
                            <p data-toggle = "modal" data-target = "#q{{single_quiz.id}}">
                                {{ single_quiz.title }}
                            </p>
                            <div class="modal fade" id="q{{single_quiz.id}}" tabindex="-1" role="dialog"
                                aria-labelledby="mySmallModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-sm">
                                    <div class="modal-content">
                                    {{ single_quiz.description | safe }}
                                </div></div>
                            </div>
                        </td>
                        <td class='text-right'>
                            <a  href='{{url_for('pages.get_grades', qid=single_quiz.id)}}' type="button" class="btn btn-primary btn-sm">
                            Grade
                            </a>
                            <a  href='#' type="button" class="btn btn-primary btn-sm">
                                Edit
                            </a>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
<!/div>

{% endblock %}